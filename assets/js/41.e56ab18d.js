(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{899:function(s,t,e){"use strict";e.r(t);var a=e(5),r=Object(a.a)({},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"node相关问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node相关问题"}},[s._v("#")]),s._v(" Node相关问题")]),s._v(" "),e("h2",{attrs:{id:"_1-uncaught-referenceerror-require-is-not-defined"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-uncaught-referenceerror-require-is-not-defined"}},[s._v("#")]),s._v(" 1.Uncaught ReferenceError: require is not defined")]),s._v(" "),e("h3",{attrs:{id:"问题原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题原因"}},[s._v("#")]),s._v(" 问题原因")]),s._v(" "),e("p",[s._v("这个问题应该是出现最多的一个问题了，原因在于 "),e("code",[s._v("Vite")]),s._v(" 是完全依靠 "),e("code",[s._v("ESM")]),s._v(" 原生能力的，也就是他只认识 "),e("code",[s._v("import")]),s._v(" ，因为 "),e("code",[s._v("Vite")]),s._v(" 依赖 "),e("code",[s._v("script")]),s._v(" 的 "),e("code",[s._v("module")]),s._v(" 属性。我们的代码最终都会被送到浏览器里执行，"),e("code",[s._v("require")]),s._v(" 是 "),e("code",[s._v("cjs")]),s._v(" 的关键词，浏览器环境本身就没定义这个方法，自然就报错了。这里和 "),e("code",[s._v("webpack")]),s._v(" 不一样，"),e("code",[s._v("webpack")]),s._v(" 把文件送到浏览器之前是会进行预打包的，这时候已经将 "),e("code",[s._v("require")]),s._v(" 转换成 浏览器能兼容的方法了。")]),s._v(" "),e("h3",{attrs:{id:"解决办法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决办法"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),e("p",[s._v("目前没有特别好的办法，如果是自己写的模块里有用 "),e("code",[s._v("require")]),s._v(" 关键词的，需要替换成 "),e("code",[s._v("import")]),s._v(" ，但如果是第三方模块的话，如果包里面用到了 "),e("code",[s._v("require")]),s._v(" 可能就无解了，目前项目中遇到的包包括 "),e("code",[s._v("react-intl")]),s._v(" 、"),e("code",[s._v("bizcharts")]),s._v("等，如果大家项目中也用到了这些，可以尝试找替换包。")]),s._v(" "),e("blockquote",[e("p",[s._v("顺便一提，"),e("code",[s._v("antd")]),s._v("的样式导入不能用 "),e("code",[s._v("css.js")]),s._v(" 导入，因为里面有用到 "),e("code",[s._v("require")]),s._v(" 关键词引 "),e("code",[s._v("less")]),s._v(" 文件，浏览器运行也会出错。")])]),s._v(" "),e("h2",{attrs:{id:"_2-node-相关方法都无法使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-node-相关方法都无法使用"}},[s._v("#")]),s._v(" 2.Node 相关方法都无法使用")]),s._v(" "),e("h3",{attrs:{id:"问题原因-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题原因-2"}},[s._v("#")]),s._v(" 问题原因")]),s._v(" "),e("p",[s._v("也是因为直接送到浏览器的原因，没有预先做过处理，像 "),e("strong",[s._v("process")]),s._v(" 、"),e("strong",[s._v("event")]),s._v(" 这些 "),e("code",[s._v("node")]),s._v(" 对象都无法在浏览器里找到定义。")]),s._v(" "),e("h3",{attrs:{id:"解决办法-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决办法-2"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),e("p",[s._v("可以用社区的兼容浏览器的包进行 "),e("strong",[s._v("polyfill")]),s._v("，目前作者项目中主要用到 "),e("strong",[s._v("process")]),s._v(" 、"),e("strong",[s._v("event")]),s._v("，"),e("strong",[s._v("process")]),s._v(" 可以用 "),e("a",{attrs:{href:"https://github.com/calvinmetcalf/node-process-es6",target:"_blank",rel:"noopener noreferrer"}},[s._v("process-es6"),e("OutboundLink")],1),s._v(" 做兼容。")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" process "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'process-es6/browser.js'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//浏览器里赋值给 window")]),s._v("\nglobal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("process "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("event")]),s._v(" 可以通过 "),e("a",{attrs:{href:"https://github.com/browserify/events",target:"_blank",rel:"noopener noreferrer"}},[s._v("events"),e("OutboundLink")],1),s._v(" 做兼容，装完就可以了，不需要额外配置。")]),s._v(" "),e("h2",{attrs:{id:"_3-xxx-does-not-provide-an-export-named-xxx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-xxx-does-not-provide-an-export-named-xxx"}},[s._v("#")]),s._v(" 3. xxx does not provide an export named 'xxx'")]),s._v(" "),e("h3",{attrs:{id:"问题原因-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题原因-3"}},[s._v("#")]),s._v(" 问题原因")]),s._v(" "),e("p",[s._v("大部分第三方包都是 "),e("code",[s._v("cjs")]),s._v(" 导出的，也就是只有一个导出口，比如 "),e("code",[s._v("axios")]),s._v(" 、"),e("code",[s._v("jquery")]),s._v("、"),e("code",[s._v("lodash")]),s._v("等，他们的导出方式类似下面这样。")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./xxx'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("显然，这并不能被 "),e("code",[s._v("Vite")]),s._v(" 识别，因为 "),e("code",[s._v("Vite")]),s._v(" 只支持 "),e("code",[s._v("ESM")]),s._v(" 的导出方式，这部分第三方包需要做个兼容。")]),s._v(" "),e("h3",{attrs:{id:"解决办法-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决办法-3"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),e("p",[s._v("好在官方已经提供了解决办法，参考这次 "),e("a",{attrs:{href:"https://github.com/vitejs/vite/issues/813",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue"),e("OutboundLink")],1),s._v(" 。"),e("code",[s._v("viteConfig")]),s._v(" 里提供了 "),e("code",[s._v("optimizeDeps")]),s._v(" 参数，专门来处理这些 "),e("code",[s._v("cjs")]),s._v(" 导出的包，使他变为 "),e("code",[s._v("ESM")]),s._v(" 导出，像这样。")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//viteConfig.js")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("optimizeDeps")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("include")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'axios'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jquery'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("加完之后，错误消除。")]),s._v(" "),e("h2",{attrs:{id:"_4-failed-to-resolve-entry-for-package-xxx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-failed-to-resolve-entry-for-package-xxx"}},[s._v("#")]),s._v(" 4. Failed to resolve entry for package 'xxx'")]),s._v(" "),e("h3",{attrs:{id:"问题原因-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题原因-4"}},[s._v("#")]),s._v(" 问题原因")]),s._v(" "),e("p",[s._v("部分第三方包在 "),e("code",[s._v("package.json")]),s._v(" 里的导出位置是错误的，导致 "),e("code",[s._v("Vite")]),s._v(" 查找的时候出现了错误。")]),s._v(" "),e("h3",{attrs:{id:"解决办法-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决办法-4"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),e("p",[s._v("通过 "),e("code",[s._v("viteConfig")]),s._v(" 的 "),e("code",[s._v("resolve")]),s._v(" 参数，强制将路径换成正确的地址。")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//viteConfig.js")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resolve")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("alias")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("find")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'intl-locales-supported'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("replacement")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_modules/intl-locales-supported/src/index.ts'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"_5-alias-to-path-resolve-dirname-src-is-not-working"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-alias-to-path-resolve-dirname-src-is-not-working"}},[s._v("#")]),s._v(" 5. alias '@' to path.resolve(__dirname, './src') is not working")]),s._v(" "),e("h3",{attrs:{id:"问题原因-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题原因-5"}},[s._v("#")]),s._v(" 问题原因")]),s._v(" "),e("p",[s._v("由于 "),e("code",[s._v("Vite")]),s._v(" 本身已经用了 "),e("strong",[s._v("@")]),s._v(" 去做模块导入工作，如果用 "),e("strong",[s._v("@")]),s._v(" 别名当绝对路径去使用会有问题")]),s._v(" "),e("h3",{attrs:{id:"解决办法-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决办法-5"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),e("p",[s._v("通过多加一个 "),e("strong",[s._v("/")]),s._v(" 来规避 "),e("strong",[s._v("@")]),s._v(" 冲突的问题，具体见这次"),e("a",{attrs:{href:"https://github.com/vitejs/vite/issues/279#issuecomment-635646269",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vite.config.js")]),s._v("\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("alias")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'/@/'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"_6-兼容性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-兼容性"}},[s._v("#")]),s._v(" 6. 兼容性")]),s._v(" "),e("p",[e("code",[s._v("Vite")]),s._v(" 默认是用的浏览器原生的导模块能力，也就意味着，他需要现代浏览器的支持。以下是最低支持的浏览器版本")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("Chrome "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v("\nFirefox "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nSafari "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\nEdge "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("也就是说，这些版本以下的都是不支持 "),e("code",[s._v("module")]),s._v(" 属性的，好在我们项目不需要兼容古老的浏览器，像 "),e("code",[s._v("IE")]),s._v(" 各种版本，都不需要支持，这也是为啥我们敢重构的原因之一。")]),s._v(" "),e("p",[s._v("当然，官方也提供了低浏览器版本的解决方案，"),e("a",{attrs:{href:"https://github.com/vitejs/vite/tree/main/packages/plugin-legacy",target:"_blank",rel:"noopener noreferrer"}},[s._v("@vitejs/plugin-legacy"),e("OutboundLink")],1),s._v("，这个插件可以让 "),e("code",[s._v("Vite")]),s._v(" 打包的项目在老的浏览器里面运行，主要用  "),e("code",[s._v("@babel/preset-env")]),s._v(" 来进行转换，不过用了之后，打包速度会明显变慢，这点看取舍了。")]),s._v(" "),e("Vssue")],1)},[],!1,null,null,null);t.default=r.exports}}]);